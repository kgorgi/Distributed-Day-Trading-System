version: "3"
services:
  web:
    container_name: "web-server"
    build:
      context: .
      dockerfile: docker-files/local/Dockerfile.web
    environment:
      - ENV=DOCKER
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  transaction:
    container_name: "transaction-server"
    build:
      context: .
      dockerfile: docker-files/local/Dockerfile.transaction
    environment:
      - ENV=DOCKER
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  quote-cache:
    container_name: "quote-cache-server"
    build:
      context: .
      dockerfile: docker-files/local/Dockerfile.quote-cache
    environment:
      - ENV=DOCKER
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  data:
    container_name: "data-server"
    depends_on:
      - dataDB
    build:
      context: .
      dockerfile: docker-files/local/Dockerfile.data
    environment:
      - ENV=DOCKER
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  dataDB:
    image: mongo:latest
    container_name: "data-mongodb"
    command: mongod --auth
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
      MONGO_INITDB_DATABASE: extremeworkload
    volumes:
      - ./data-mongo-init.js:/docker-entrypoint-initdb.d/data-mongo-init.js:ro
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  audit:
    container_name: "audit-server"
    depends_on:
      - auditDB
    build:
      context: .
      dockerfile: docker-files/local/Dockerfile.audit
    environment:
      - ENV=DOCKER
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

  auditDB:
    image: mongo:latest
    container_name: "audit-mongodb"
    environment:
      MONGO_INITDB_DATABASE: audit
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
